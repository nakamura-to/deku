/*
 tempura - simple templating library in javascript.
 https://github.com/nakamura-to/tempura
*/
(function(p){var f={toString:Object.prototype.toString,slice:Array.prototype.slice,isObject:function(b){return b===Object(b)},isPlainObject:function(b){return"[object Object]"===f.toString.call(b)},isArray:function(b){return"[object Array]"===f.toString.call(b)},isFunction:function(b){return"[object Function]"===f.toString.call(b)},isString:function(b){return"[object String]"===f.toString.call(b)},trim:function(b){return null===b||void 0===b?"":b.replace(/^\s+/,"").replace(/\s+$/,"")},extend:function(b){var d=
f.slice.call(arguments,1),a=d.length,e,c,g;if(null===b||void 0===b||0===a)return b;for(e=0;e<a;e++)if(c=d[e],null!==c&&void 0!==c)for(g in c)void 0===b[g]&&(b[g]=c[g]);return b},deepExtend:function(b){var d=f.slice.call(arguments,1),a=d.length,e,c,g;if(null===b||void 0===b||0===a)return b;g=function(a,b){var e,d,c;for(e in b){d=b[e];c=a[e];var h=f.isArray(d);h||f.isPlainObject(d)?(c=c||(h?[]:{}),g(c,d),a[e]=c):void 0===c&&(a[e]=d)}};for(e=0;e<a;e++)c=d[e],null!==c&&void 0!==c&&g(b,c);return b},encode:function(b){return(null===
b||void 0===b?"":""+b).replace(/[&"'<>]/g,function(b){switch(b){case "&":return"&amp;";case '"':return"&quot;";case "'":return"&#39;";case "<":return"&lt;";case ">":return"&gt;";default:return b}})}},c={TEMPURA_CONTEXT_MARK:"__tempura__",TEMPURA_OPTIONS:"__tempura__options",ROOT_CONTEXT:"$root",PARENT_CONTEXT:"$parent",THIS:"$this",OTAG:"{{",CTAG:"}}",shouldBePreserveUnknownTags:function(b){return!0===(b[c.TEMPURA_OPTIONS]||{}).preserveUnknownTags},getTagPair:function(){var b={};return function(d){var a=
d[c.TEMPURA_OPTIONS]||{},d=a.otag||c.OTAG,a=a.ctag||c.CTAG,e=d+"\u0008"+a,h=b[e];h||(h=b[e]={otag:d,ctag:a});return h}}(),includes:function(b,d,a){a=c.getTagPair(a);return-1!==d.indexOf(a.otag+b)},createContext:function(b,d){var a;if(d[c.TEMPURA_CONTEXT_MARK])return d;if(!b[c.TEMPURA_CONTEXT_MARK])throw Error("illegal parent context.");a={};a[c.TEMPURA_CONTEXT_MARK]=!0;a[c.TEMPURA_OPTIONS]=b[c.TEMPURA_OPTIONS];a[c.ROOT_CONTEXT]=b[c.ROOT_CONTEXT];a[c.PARENT_CONTEXT]=b;a[c.THIS]=d;return f.extend(a,
d)},walk:function(b,d){for(var a=b.split("."),e=d[a.shift()];null!==e&&void 0!==e&&0<a.length;)d=c.createContext(d,e),e=d[a.shift()];return{found:void 0!==e&&0===a.length,value:e,context:d}},applyPipes:function(b,d,a){var e=a[c.TEMPURA_OPTIONS]||{},h=e.pipes||{},e=e.noSuchPipe,g,i,k,n=d.length,j;for(k=0;k<n;k++)j=d[k],g=c.walk(j,a),i=g.value,f.isFunction(i)?b=i.call(g.context,b):(g=h[j],f.isFunction(g)?b=g.call(a,b):f.isFunction(e)&&(b=e.call(a,j,k,b)));return b},applyPreRender:function(b,d,a){var e=
(d[c.TEMPURA_OPTIONS]||{}).preRender;return f.isFunction(e)?e.call(d,b,a):a(b)},noSuchValue:function(b,d){var a=(d[c.TEMPURA_OPTIONS]||{}).noSuchValue;return f.isFunction(a)?a.call(d,b):void 0},resolveValue:function(b,d,a){var e=c.walk(b,d),h=e.found;if(!h&&c.shouldBePreserveUnknownTags(d))return d=c.getTagPair(d),d.otag+b+a.pipeNamesDef+d.ctag;b=h?e.value:c.noSuchValue(b,d);f.isFunction(b)&&(b=b.call(e.context));return c.applyPreRender(b,d,a)},transformTags:function(){var b=function(a){var a=c.getTagPair(a),
b=a.tagsRegex;if(!b)b=a.tagsRegex=RegExp([a.otag,"([#\\^/!{])?(.+?)(?:\\|(.*?))?",a.ctag,"+"].join(""),"g");return b},d=function(a,b,d,g){var a=f.trim(a),i=function(a){var g,j,i,l,m=[];if(null!==b&&void 0!==b){g=b.split("|");i=g.length;for(j=0;j<i;j++)(l=f.trim(g[j]))&&m.push(l)}return c.applyPipes(a,m,d)};i.pipeNamesDef=b||"";a=c.resolveValue(a,d,i);return g(a)};return function(a,e){var h=c.getTagPair(e),g=h.otag,i=h.ctag,h=function(a,b,c,h){switch(b){case "#":return g+"#"+c+i;case "^":return g+
"^"+c+i;case "/":return g+"/"+c+i;case "!":return"";case "{":return d(c,h,e,function(a){return null===a||void 0===a?"":""+a});default:return d(c,h,e,f.encode)}},k=a.split("\n"),n,j,q=k.length,l=b(e);for(j=0;j<q;j++)n=k[j],k[j]=n.replace(l,h);return k.join("\n")}}(),transformSection:function(){var b=function(a){var a=c.getTagPair(a),b=a.sectionRegex;if(!b)b=a.sectionRegex=RegExp(["^([\\s\\S]*?)",a.otag,"([#\\^])\\s*(.+)\\s*",a.ctag,"\n*([\\s\\S]*?)",a.otag,"\\/\\s*\\3\\s*",a.ctag,"\n*([\\s\\S]*)$"].join(""),
"g");return b},d=function(a,b,d,g){var i=d.length,k=[];if("#"===a){if(f.isArray(d)){for(a=0;a<i;a++)k[a]=c.transform(b,c.createContext(g,d[a]));return k.join("")}if(f.isFunction(d)){if(d.call(g))return c.transform(b,g)}else{if(f.isObject(d))return c.transform(b,c.createContext(g,d));if(d)return c.transform(b,g)}}else if("^"===a&&(f.isArray(d)&&0===d.length||!d))return c.transform(b,g);return""};return function(a,e){var f=c.getTagPair(e),g=f.otag,i=f.ctag;return!c.includes("#",a,e)&&!c.includes("^",
a,e)?!1:a.replace(b(e),function(b,a,f,h,l,m){b=a?c.transformTags(a,e):"";m=m?c.transform(m,e):"";a=c.walk(h,e);!a.found&&c.shouldBePreserveUnknownTags(e)?f=g+f+h+i+l+g+"/"+h+i:(h=a.found?a.value:c.noSuchValue(h,e),f=d(f,l,h,a.context));return b+f+m})}}(),transform:function(b,d){var a=c.transformSection(b,d);!1===a&&(a=c.transformTags(b,d));return a},createInitialContext:function(b,d){var a={};a[c.TEMPURA_CONTEXT_MARK]=!0;a[c.TEMPURA_OPTIONS]=d;a[c.ROOT_CONTEXT]=a;a[c.PARENT_CONTEXT]=null;a[c.THIS]=
b;f.extend(a,b);return a},toHtml:function(b,d,a){d=c.createInitialContext(d,a);return c.transform(b,d)},prepare:function(b,d){return{render:function(a){return c.toHtml(b,a,d)}}}},o=function(){var b=f.deepExtend({},{otag:c.OTAG,ctag:c.CTAG,preserveUnknownTags:!1,pipes:{},preRender:function(b,a){var c=a(b);return void 0===c?"":c},noSuchValue:function(){},noSuchPipe:function(b,a,c){return c}});return{name:"tempura",version:"0.0.2",getSettings:function(){return b},setSettings:function(c){b=c},mergeSettings:function(c){b=
f.deepExtend({},c,b)},prepare:function(d,a){a=f.deepExtend({},a,b);return c.prepare(d,a)},internal:{util:f,core:c}}}();"undefined"!==typeof module?module.exports=o:"function"===typeof define&&define.amd?define("tempura",function(){return o}):p.tempura=o})(this);
